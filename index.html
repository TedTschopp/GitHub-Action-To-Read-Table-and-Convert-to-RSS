---
layout: default
class: home-template
---

<!-- Start Featured Posts -->
<div class="featured-posts">
    <div class="section-title">
        <h2><span>RSS Feeds</span></h2>
    </div>
    <div class="row">
        {% for feed in site.rss_feeds %}
        <div class="col-md-12">
            <div class="card border-0 mb-4 box-shadow">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <h2 class="card-title"><a href="{{ feed.url }}">{{ feed.name }}</a></h2>
                            <small class="d-block text-muted">{{ feed.description }}</small>
                        </div>
                        <div class="col-auto">
                            <a href="{{ feed.url }}" class="btn btn-sm btn-outline-success">
                                <i class="fas fa-rss"></i> RSS
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="{{ feed.name | slugify }}-preview" class="rss-preview">
                        Loading latest entries...
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- RSS Status -->
<div class="rss-status mt-5" style="display: none;">
    <div class="section-title">
        <h2><span>Feed Status</span></h2>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="card border-0 box-shadow">
                <div class="card-body">
                    <div id="rss-status-content">
                        Loading feed status...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for RSS preview -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load RSS status
    fetch('/rss_status.json')
        .then(response => response.json())
        .then(data => {
            const statusContent = document.getElementById('rss-status-content');
            let statusHtml = '<div class="row">';
            
            if (data.feeds) {
                Object.entries(data.feeds).forEach(([feedName, feedData]) => {
                    const statusClass = feedData.status === 'healthy' ? 'success' : 'danger';
                    const statusIcon = feedData.status === 'healthy' ? 'check-circle' : 'exclamation-triangle';
                    
                    statusHtml += `
                        <div class="col-md-6 mb-3">
                            <div class="alert alert-${statusClass} d-flex align-items-center">
                                <i class="fas fa-${statusIcon} me-2"></i>
                                <div>
                                    <strong>${feedName}</strong><br>
                                    <small>
                                        Entries: ${feedData.entry_count || 0} | 
                                        Last Updated: ${feedData.last_updated ? new Date(feedData.last_updated).toLocaleString() : 'Unknown'}
                                    </small>
                                    ${feedData.error ? `<br><small class="text-muted">Error: ${feedData.error}</small>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            statusHtml += '</div>';
            statusContent.innerHTML = statusHtml;
        })
        .catch(error => {
            console.error('Error loading RSS status:', error);
            document.getElementById('rss-status-content').innerHTML = 
                '<div class="alert alert-warning">Unable to load feed status</div>';
        });

    // Load RSS previews
    const rssFeeds = {{ site.rss_feeds | jsonify }};
    const rssPreviewLimit = {{ site.rss_preview_limit | default: 5 }};
    
    rssFeeds.forEach(feed => {
        const previewElement = document.getElementById(feed.name.toLowerCase().replace(/\s+/g, '-') + '-preview');
        
        fetch(feed.url)
            .then(response => response.text())
            .then(xmlText => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                const items = xmlDoc.querySelectorAll('item');
                
                let previewHtml = '<ul class="list-unstyled">';
                
                // Sort all items by publication date (newest first)
                const sortedItems = Array.from(items).sort((a, b) => {
                    const dateA = new Date(a.querySelector('pubDate')?.textContent || 0);
                    const dateB = new Date(b.querySelector('pubDate')?.textContent || 0);
                    return dateB - dateA; // Descending order (newest first)
                });
                
                // Filter items from last 7 days
                const sevenDaysAgo = new Date();
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                
                const recentItems = sortedItems.filter(item => {
                    const pubDateText = item.querySelector('pubDate')?.textContent;
                    if (pubDateText) {
                        const pubDate = new Date(pubDateText);
                        return pubDate >= sevenDaysAgo;
                    }
                    return false; // Exclude items without valid dates
                });
                
                // Use the larger of: items from last 7 days OR rssPreviewLimit
                const itemsToShow = Math.max(recentItems.length, rssPreviewLimit);
                const finalItems = itemsToShow <= recentItems.length ? recentItems : sortedItems;
                
                // Show items (either recent items or up to preview limit)
                for (let i = 0; i < Math.min(itemsToShow, finalItems.length); i++) {
                    const item = finalItems[i];
                    let title = item.querySelector('title')?.textContent || 'No title';
                    const link = item.querySelector('link')?.textContent || '#';
                    const pubDate = item.querySelector('pubDate')?.textContent;
                    const description = item.querySelector('description')?.textContent;
                    
                    // Parse title for priority tags
                    let priorityBadge = '';
                    let cleanTitle = title;
                    let backgroundStyle = '';
                    
                    if (title.endsWith('[ ! ]')) {
                        priorityBadge = '<span class="badge bg-danger me-2">Essential</span>';
                        cleanTitle = title.replace(/\s*\[\s*!\s*\]\s*$/, '').trim();
                        backgroundStyle = 'style="background-color: rgba(220, 53, 69, 0.1); border-left: 3px solid rgba(220, 53, 69, 0.5); padding-left: 8px;"';
                    } else if (title.endsWith('[ * ]')) {
                        priorityBadge = '<span class="badge bg-warning text-dark me-2">Important</span>';
                        cleanTitle = title.replace(/\s*\[\s*\*\s*\]\s*$/, '').trim();
                        backgroundStyle = 'style="background-color: rgba(255, 193, 7, 0.1); border-left: 3px solid rgba(255, 193, 7, 0.5); padding-left: 8px;"';
                    } else if (title.endsWith('[ ~ ]')) {
                        priorityBadge = '<span class="badge bg-secondary me-2">Optional</span>';
                        cleanTitle = title.replace(/\s*\[\s*~\s*\]\s*$/, '').trim();
                        backgroundStyle = 'style="background-color: rgba(108, 117, 125, 0.1); border-left: 3px solid rgba(108, 117, 125, 0.5); padding-left: 8px;"';
                    }
                    
                    let formattedDate = '';
                    if (pubDate) {
                        const date = new Date(pubDate);
                        formattedDate = date.toLocaleDateString();
                    }
                    
                    previewHtml += `
                        <li class="mb-2">
                            <a href="${link}" target="_blank" class="text-decoration-none d-block p-2 rounded" ${backgroundStyle}>
                                ${priorityBadge}<strong>${cleanTitle}</strong>
                                ${formattedDate ? `<small class="text-muted d-block">${formattedDate}</small>` : ''}
                                ${description ? `<small class="text-muted d-block">${description}...</small>` : ''}
                            </a>
                        </li>
                    `;
                }
                
                previewHtml += '</ul>';
                
                if (items.length === 0) {
                    // Hide the entire feed card if no items
                    const feedCard = previewElement.closest('.card').parentElement;
                    feedCard.style.display = 'none';
                    return;
                }
                
                previewElement.innerHTML = previewHtml;
            })
            .catch(error => {
                console.error('Error loading RSS feed:', error);
                previewElement.innerHTML = '<div class="alert alert-warning">Unable to load feed preview</div>';
            });
    });
});
</script>
