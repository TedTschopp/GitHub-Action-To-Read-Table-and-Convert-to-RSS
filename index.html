---
layout: default
class: home-template
---

<!-- Start Featured Posts -->
<div class="featured-posts">
    <div class="section-title">
        <h2><span>RSS Feeds</span></h2>
    </div>
        <div class="row">
    {% for feed in site.feeds %}
            <div class="col-md-12">
                <div class="card border-0 mb-4 box-shadow">
                    <div class="card-header d-flex justify-content-between align-items-start flex-wrap">
                        <div>
                            <h2 class="card-title mb-1"><a href="{{ feed.url }}">{{ feed.name }}</a></h2>
                            <small class="text-muted">{{ feed.description }}</small>
                        </div>
                        <div>
                            <a href="{{ feed.url }}" class="btn btn-sm btn-outline-success"><i class="fas fa-rss"></i> RSS</a>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="feed-preview-{{ forloop.index0 }}" class="rss-preview" data-feed-index="{{ forloop.index0 }}">Loading latest entries...</div>
                    </div>
                </div>
            </div>
        {% endfor %}
        </div>
</div>

<!-- RSS Status -->
<div class="rss-status mt-5" style="display: none;">
    <div class="section-title">
        <h2><span>Feed Status</span></h2>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="card border-0 box-shadow">
                <div class="card-body">
                    <div id="rss-status-content">
                        Loading feed status...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Priority styling restored */
    .rss-items { list-style: none; padding-left: 0; margin: 0; }
    .rss-items li { margin: 0 0 4px 0; line-height: 1.25; }
    .rss-items li.priority-essential { background: rgba(220,53,69,.08); border-left: 3px solid rgba(220,53,69,.6); padding:4px 6px; }
    .rss-items li.priority-important { background: rgba(255,193,7,.12); border-left: 3px solid rgba(255,193,7,.7); padding:4px 6px; }
    .rss-items li.priority-optional { background: rgba(108,117,125,.10); border-left: 3px solid rgba(108,117,125,.55); padding:4px 6px; }
    .rss-items li a { text-decoration: none; color: inherit; }
    .pri-badge { font-size: .60rem; letter-spacing:.5px; text-transform:uppercase; margin-right:6px; padding:2px 5px; border-radius:3px; font-weight:600; background:#555; color:#fff; position:relative; top:-1px; }
    .pri-badge.essential { background:#dc3545; }
    .pri-badge.important { background:#ffc107; color:#222; }
    .pri-badge.optional { background:#6c757d; }
    .pubdate { font-size:.65rem; color:#666; }
</style>

<!-- JavaScript for RSS preview -->
<script>
(function(){
    if(document.readyState==='loading'){
        document.addEventListener('DOMContentLoaded', arguments.callee, {once:true});
        return;
    }
    const allFeeds = {{ site.feeds | jsonify }};
    // Filter to only enabled feeds (skip feeds with enabled: false)
    const feeds = allFeeds.filter(f => f.enabled !== false);
    // Showing all items (preview limit removed as per request)
    function esc(s){return (s||'').replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]||c));}
    function parseItems(xml){
        const doc = new DOMParser().parseFromString(xml,'application/xml');
        if(doc.querySelector('parsererror')) return [];
        const items = Array.from(doc.querySelectorAll('item')).map((it,idx)=>{
            const rawTitle = it.querySelector('title')?.textContent || 'Untitled';
            const linkNode = it.querySelector('link');
            const linkVal = linkNode ? linkNode.textContent : '#';
            const dRaw = it.querySelector('pubDate')?.textContent; 
            let pubDateISO=''; let pubTime=0;
            if(dRaw){
                const dt = new Date(dRaw);
                if(!isNaN(dt)) { pubDateISO = dt.toISOString().slice(0,10); pubTime = dt.getTime(); }
            }
            let priorityClass=''; let badge=''; let cleanedTitle=rawTitle;
            if(/\[\s*!\s*\]$/.test(rawTitle)){ priorityClass='priority-essential'; badge='<span class="pri-badge essential">Essential</span>'; cleanedTitle=rawTitle.replace(/\s*\[\s*!\s*\]\s*$/,'').trim(); }
            else if(/\[\s*\*\s*\]$/.test(rawTitle)){ priorityClass='priority-important'; badge='<span class="pri-badge important">Important</span>'; cleanedTitle=rawTitle.replace(/\s*\[\s*\*\s*\]\s*$/,'').trim(); }
            else if(/\[\s*~\s*\]$/.test(rawTitle)){ priorityClass='priority-optional'; badge='<span class="pri-badge optional">Optional</span>'; cleanedTitle=rawTitle.replace(/\s*\[\s*~\s*\]\s*$/,'').trim(); }
            const t = esc(cleanedTitle);
            const l = esc(linkVal||'#');
            return { html: `<li class="${priorityClass}"><a href="${l}" rel="noopener noreferrer">${badge}<strong>${t}</strong></a>${pubDateISO?` <span class=\"pubdate\">(${pubDateISO})</span>`:''}</li>`, time: pubTime, idx };
        });
        // Sort newest first; stable by original index for identical timestamps
        items.sort((a,b)=> b.time - a.time || a.idx - b.idx);
        return items.map(o=>o.html);
    }
    feeds.forEach((f,i)=>{
        const el = document.getElementById('feed-preview-'+i);
        if(!el) return;
        fetch(f.url).then(r=>{ if(!r.ok) throw new Error('HTTP '+r.status); return r.text(); })
            .then(txt=>{
                const items = parseItems(txt);
                el.innerHTML = items.length ? `<ul class="rss-items">${items.join('')}</ul>` : '<div class="text-muted"><small>No recent items.</small></div>';
            })
            .catch(err=>{ el.innerHTML = '<div class="rss-error"><small>Preview error: '+esc(err.message)+'</small></div>'; });
    });
})();
</script>
